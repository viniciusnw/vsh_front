"use strict";var app=angular.module("vsh",["ngRoute","ngCookies","ngAnimate","angular-loading-bar"]);app.constant("$frontendUrl","http://localhost:8000"),app.constant("$urlApi","http://vsh-api"),app.run(["AuthService",function(e){e.loadPages()}]),app.config(["$routeProvider",function(e){e.when("/convite",{viewContainerClass:"bg-color brand-gray",access:"public",templateUrl:"views/pages/invite/inviteRequest.html",controller:"InviteRequest",controllerAs:"inviteRequest"}).when("/recuperar-senha",{viewContainerClass:"bg-color brand-gray",access:"public",templateUrl:"views/pages/password/passwordForgot.html",controller:"Password",controllerAs:"password"}).when("/redefinir-senha/:token",{viewContainerClass:"bg-color brand-gray",access:"public",templateUrl:"views/pages/password/passwordRedefine.html",controller:"Password",controllerAs:"password"}).when("/primeiro-acesso/:token",{viewContainerClass:"bg-color brand-gray",access:"public",templateUrl:"views/pages/password/passwordCreate.html",controller:"Password",controllerAs:"password"}).when("/login",{viewContainerClass:"bg-color brand-gray",access:"public",templateUrl:"views/pages/login.html",controller:"Login",controllerAs:"login"}).when("/dashboard",{showHeader:!0,templateUrl:"views/pages/dashboard/dashboard.html",controller:"Events",controllerAs:"events"}).when("/conta/editar/:tab?",{showHeader:!0,templateUrl:"views/pages/user/userEdit.html",controller:"UserEdit",controllerAs:"userEdit"}).when("/calendario",{showHeader:!0,templateUrl:"views/pages/calendar/calendar.html",controller:"Calendar",controllerAs:"calendar"}).when("/admin/usuarios",{templateUrl:"views/pages/admin/users.html",controller:"Admin",controllerAs:"admin"}).otherwise({redirectTo:"/dashboard"})}]),app.factory("Cookie",["$cookies",function(e){return{set:function(t,a,n){e.put(t,a,n)},get:function(t){return e.get(t)},remove:function(t){e.remove(t)}}}]),app.factory("Token",["Cookie",function(e){var t="userToken";return{set:function(a,n){e.set(t,a,n)},get:function(){return e.get(t)},remove:function(){e.remove(t)}}}]),app.factory("UserCookie",["Cookie",function(e){var t="userInfosId",a="userInfosName",n="userInfosEmail";return{set:function(r,o,s,i){e.set(t,r,i),e.set(a,o,i),e.set(n,s,i)},get:function(){return{id:e.get(t),name:e.get(a),email:e.get(n)}},remove:function(){e.remove(t),e.remove(a),e.remove(n)}}}]),app.factory("AuthService",["RestService","Token","$rootScope","$window",function(e,t,a,n){e.endpoint="/user";var r=function(){return!!t.get()};return{login:function(t){return e.REST(!1,"post","/login",t)},logout:function(){return e.REST(!0,"post","/logoff",login)},loadPages:function(){a.$on("$routeChangeStart",function(a,n,r){t(n),o(n),e(n)});var e=function(e){var t="/#/event",a="/#/login",o=n.location.hash,s=o.indexOf("#/login")!==-1||"/login"==e.originalPath,i=e&&e.access||"private";if(s&&r())n.location.href=t;else if("private"!==i||r()){if("public"===i)return}else n.location.href=a},t=function(e){a.viewContainerClass=e.viewContainerClass,a.showHeader=e.showHeader},o=function(e){e.params.alert||(a.alert={message:!1})}}}}]),app.factory("RestService",["$http","$urlApi","$window","Token","$rootScope",function(e,t,a,n,r){function o(e){console.log(e),"not_authorized"===e.error?(r.alert={message:"Efetue o login novamente",type:"danger"},n.remove(),a.location.href="/#/login?alert=1"):e.status||(r.alert={message:e.message,type:"danger"})}function s(e){console.log("error"),console.log(e)}return this.endpoint="",{REST:function(a,r,i,c){var l={"Content-Type":"application/json; charset=UTF-8",Authorization:function(){if(a)return"Bearer "+n.get()}()},u={method:r,url:t+this.endpoint+i,headers:l,data:c};return e(u).success(o).error(s)}}}]),app.factory("UserService",["RestService",function(e){return e.endpoint="/user",{users:function(){return e.REST(!0,"get","/users/")},user:function(t){return e.REST(!0,"get","/users/"+t)},userEdit:function(t){return e.REST(!0,"put","/users/",t)},requestInvite:function(t,a){var n={name:t,email:a};return e.REST(!1,"post","/invite/",n)},acceptInvite:function(t){var a={id:t};return e.REST(!0,"put","/invite/",a)},forgotPassword:function(t){var a={email:t};return e.REST(!1,"post","/password/",a)},redefinePassword:function(t,a,n){var r={old_pass:t,password:a,pass_confirm:n};return e.REST(!0,"put","/password/",r)},createPassword:function(t,a){var n={password:t,pass_confirm:a};return e.REST(!0,"post","/users/",n)}}}]),app.directive("vshAlerts",function(){return{templateUrl:"views/directives/alerts.html",scope:{alert:"="},link:function(e){$(".close").on("click",function(){e.alert.message=!1,e.$apply()})}}}),app.directive("animateModelChange",function(){return{link:function(e,t,a){e.$watch(function(){return a.model},function(e,a){e==a?t.addClass("start"):(t.removeClass("start"),t.addClass("finally"))})}}}),app.directive("vshCalendar",function(){return{link:function(e,t,a){e.$watch(function(){return a.events},function(e,t){console.log(t),console.log(e)}),$("#calendar").fullCalendar({lang:"pt-br",header:{left:"prev,next",center:"title",right:"month,basicWeek,basicDay"},defaultDate:"2016-06-12",editable:!0,eventLimit:!0,events:[{title:"All Day Event",start:"2016-06-01"},{title:"Long Event",start:"2016-06-07",end:"2016-06-10"},{id:999,title:"Repeating Event",start:"2016-06-09T16:00:00"},{id:999,title:"Repeating Event",start:"2016-06-16T16:00:00"},{title:"Conference",start:"2016-06-11",end:"2016-06-13"},{title:"Meeting",start:"2016-06-12T10:30:00",end:"2016-06-12T12:30:00"},{title:"Lunch",start:"2016-06-12T12:00:00"},{title:"Meeting",start:"2016-06-12T14:30:00"},{title:"Happy Hour",start:"2016-06-12T17:30:00"},{title:"Dinner",start:"2016-06-12T20:00:00"},{title:"Birthday Party",start:"2016-06-13T07:00:00"},{title:"Click for Google",url:"http://google.com/",start:"2016-06-28"}]})}}}),app.directive("inputsFlowUp",function(){return{link:function(e,t,a){var n="#"+t[0].id;$(n+" .flow-up .form-control").val()&&$(n+" .flow-up .form-control").parent().addClass("active"),$(document).on("focus",n+" .flow-up .form-control",function(){$(this).parent().addClass("active")}),$(document).on("blur",n+" .flow-up .form-control",function(){$(this).val()||$(this).parent().removeClass("active")})}}}),app.directive("pushMenu",function(){return{link:function(e,t,a){var n="#"+t[0].id,r="."+$(n).data("class-menu"),o=$(n).data("open");$(n).on("click",function(e){$(".navbar-left, .navbar-right").removeClass("active"),e.stopPropagation(),0==o&&($(n).data("open",1),$(r).addClass("active")),s()});var s=function(){$(document).one("click",function(e){$(e.target).is(r)?s():($(n).data("open",0),$(r).removeClass("active"))})}}}}),app.directive("uploadImage",["$rootScope",function(e){return{template:"<input type='file' accept='image/*'> <div id='renderUploadImages'></div>",link:function(t,a,n){a[0].onchange=function(t){var n=(t.srcElement||t.target).files[0],r=new FileReader;r.readAsDataURL(n),r.onload=function(t){var n="<div class='container-foto-enviada'> \n                                <img width='300' heigth='300' class='foto-enviada' src='"+t.target.result+"'> \n                               </div>";a[0].children.renderUploadImages.innerHTML=n,e.urlNewAvatar=t.target.result,e.$apply()}}}}}]),app.controller("Admin",["UserService","$rootScope",function(e,t){var a=this;a.users={},a.listUser=function(){e.users().then(function(e){t(e)});var t=function(e){var t=e.data,n=e.data.data;t.status&&(a.users=n)}}(),a.block=function(e){alert(e)},a.release=function(e){alert(e)}}]),app.controller("Calendar",function(){var e=this;e.events="teste",e.click=function(){e.events="novo valor"}}),app.controller("Events",function(){}),app.controller("Logged",["UserService","UserCookie",function(e,t){var a=this;a.avatar="",a.name="",a.email="",a.getUser=function(){e.user(t.get().id).then(function(e){n(e)});var n=function(e){var t=e.data,n=e.data.data;t.status&&(a.avatar=n.avatar,a.name=n.name,a.email=n.email)}}()}]),app.controller("InviteAccept",["UserService","$rootScope","$window",function(e,t,a){var n=this;n.id="",n.acceptInvite=function(){e.acceptInvite(n.id).then(function(e){r(e)});var r=function(e){var n=e.data;e.data.data;n.status&&(t.alert={message:n.message,type:"success"},a.location.href="/#/login?alert=1")}}}]),app.controller("InviteRequest",["UserService","$rootScope",function(e,t){var a=this;a.name="",a.email="",a.requestInvite=function(){e.requestInvite(a.name,a.email).then(function(e){n(e)});var n=function(e){var a=e.data;e.data.data;a.status&&(t.alert={message:a.message,type:"success"},console.log(e))}}}]),app.controller("Login",["AuthService","Token","UserCookie","$window","cfpLoadingBar",function(e,t,a,n,r){var o=this;o.email="",o.password="",o.keepLogged="",o.login=function(){var r={password:o.password,email:o.email};e.login(r).then(function(e){s(e)});var s=function(e){var r=e.data,s=e.data.data,i={};if(r.status){if(o.keepLogged){var c=new Date;i={expires:new Date(c.getFullYear()+1,c.getMonth(),c.getDate())}}t.set(s.token,i),t.get()&&(a.set(s.id,s.name,s.email,i),n.location.href="/#/event")}}},o.logout=function(){t.remove(),a.remove(),n.location.href="/#/login"}}]),app.controller("Password",["UserService","Token","$routeParams","$window","$rootScope",function(e,t,a,n,r){var o=this;o.email="",o.password="",o.pass_confirm="",o.requestNewPassword=function(){e.forgotPassword(o.email).then(function(e){t(e)});var t=function(e){var t=e.data;e.data.data;t.status&&(r.alert={message:t.message,type:"success"})}},o.redefinePassword=function(){t.set(a.token,[]),e.redefinePassword("",o.password,o.pass_confirm).then(function(e){s(e)});var s=function(e){var a=e.data;e.data.data;t.remove(),a.status&&(r.alert={message:a.message,type:"success"},n.location.href="/#/login?alert=1")}},o.createPassword=function(){t.set(a.token,[]),e.createPassword(o.password,o.pass_confirm).then(function(e){s(e)});var s=function(e){var a=e.data;e.data.data;t.remove(),a.status&&(r.alert={message:a.message,type:"success"},n.location.href="/#/login?alert=1")}}}]),app.controller("UserEdit",["UserService","UserCookie","$rootScope","Token","$scope",function(e,t,a,n,r){var o=this;o.id="",o.name="",o.email="",o.phone="",o.occupation="",o.avatar="",o.old_pass="",o.pass="",o.pass_confirm="";var s;o.userView=function(){e.user(t.get().id).then(function(e){a(e)});var a=function(e){var t=e.data;s=e.data.data,t.status&&(o.id=s.id,o.name=s.name,o.email=s.email,o.phone=s.phone,o.occupation=s.occupation,o.avatar=s.avatar)}}(),o.userEdit=function(){var t={};for(var r in s)void 0!=o[r]&&o[r]!=s[r]&&(t[r]=o[r]);a.urlNewAvatar&&(t.avatar=a.urlNewAvatar),e.userEdit(t).then(function(e){i(e)});var i=function(e){var t=e.data;t.status&&(n.set(t.token,[]),a.alert={message:t.message,type:"success"})}},o.userPassEdit=function(){var t=o.old_pass?o.old_pass:"NULL";e.redefinePassword(t,o.pass,o.pass_confirm).then(function(e){n(e)});var n=function(e){var t=e.data;t.status&&(a.alert={message:t.message,type:"success"})}}}]);